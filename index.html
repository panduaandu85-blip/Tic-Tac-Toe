<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tic Tac Toe (X, O Game)</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    .cell-win {
      background: linear-gradient(135deg, #60a5fa 0%, #a7f3d0 100%) !important;
      color: #1e293b !important;
      box-shadow: 0 0 0 3px #38bdf8;
      transition: background 0.3s, color 0.3s;
    }
    .cell-draw {
      background: linear-gradient(135deg, #f87171 0%, #fbbf24 100%) !important;
      color: #7f1d1d !important;
      box-shadow: 0 0 0 3px #ef4444;
      transition: background 0.3s, color 0.3s;
    }
    .cell-animate {
      animation: pop 0.2s;
    }
    @keyframes pop {
      0% { transform: scale(0.7); }
      70% { transform: scale(1.15); }
      100% { transform: scale(1); }
    }
    .dark-mode {
      background: #1e293b !important;
      color: #f1f5f9 !important;
    }
    .dark-mode .bg-white { background: #334155 !important; }
    .dark-mode .text-blue-700 { color: #60a5fa !important; }
    .dark-mode .border-gray-200 { border-color: #64748b !important; }
    .dark-mode .bg-gradient-to-br { background: linear-gradient(135deg, #334155 0%, #1e293b 100%) !important; }
    .dark-mode input, .dark-mode button { color: #f1f5f9 !important; }
    .dark-mode .cell-win { background: linear-gradient(135deg, #38bdf8 0%, #bbf7d0 100%) !important; color: #0f172a !important; }
    .dark-mode .cell-draw { background: linear-gradient(135deg, #f87171 0%, #fde68a 100%) !important; color: #7f1d1d !important; }
  </style>
</head>

<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen">
  <div class="flex justify-between items-center w-full max-w-md mb-2">
    <h1 class="text-4xl font-extrabold text-blue-700 tracking-tight drop-shadow">Tic Tac Toe</h1>
    <button id="darkToggle" class="ml-4 px-3 py-1 rounded bg-gray-200 hover:bg-gray-300 text-gray-700 text-sm font-semibold transition">üåô Dark</button>
  </div>
  <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col items-center w-[340px]">
    <form id="nameForm" class="flex flex-col items-center gap-2 w-full mb-4">
      <div class="flex gap-2 w-full">
  <input id="playerX" type="text" placeholder="Player X Name" class="flex-1 px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400" maxlength="12">
  <input id="playerO" type="text" placeholder="Player O Name" class="flex-1 px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400" maxlength="12">
      </div>
      <button type="submit" class="mt-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition">Start Game</button>
    </form>
    <div id="scoreboard" class="flex justify-between w-full mb-2 hidden">
      <div class="flex-1 text-center">
        <span id="scoreX" class="font-bold text-blue-600">0</span>
        <span class="ml-1">(<span id="nameX">Player X</span>)</span>
        <div class="text-xs text-gray-500">‚è± <span id="timerX">0.0</span>s</div>
      </div>
      <div class="flex-1 text-center">
        <span id="scoreO" class="font-bold text-green-600">0</span>
        <span class="ml-1">(<span id="nameO">Player O</span>)</span>
        <div class="text-xs text-gray-500">‚è± <span id="timerO">0.0</span>s</div>
      </div>
    </div>
    <div id="replayControls" class="flex gap-2 mb-2 hidden">
      <button id="replayStart" class="px-2 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition">‚èÆÔ∏è</button>
      <button id="replayPrev" class="px-2 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition">‚óÄÔ∏è</button>
      <button id="replayPlay" class="px-2 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition">‚ñ∂Ô∏è</button>
      <button id="replayNext" class="px-2 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition">‚ñ∂Ô∏è</button>
      <button id="replayEnd" class="px-2 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition">‚è≠Ô∏è</button>
    </div>
    <div id="moveControls" class="flex gap-2 mb-2 hidden">
      <button id="undoBtn" class="px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition">Undo</button>
      <button id="redoBtn" class="px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition">Redo</button>
    </div>
    <div id="moveHistory" class="w-full mb-2 hidden">
      <div class="font-semibold text-gray-500 text-xs mb-1">Move History:</div>
      <ul id="moveList" class="text-xs max-h-24 overflow-y-auto bg-gray-50 rounded p-2 border border-gray-200"></ul>
    </div>
    <div id="game" class="grid grid-cols-3 gap-3 w-72 mb-4 hidden">
      <!-- Cells will be generated by JS -->
    </div>
    <div id="status" class="mb-4 text-lg font-semibold min-h-[32px] text-center"></div>
    <div class="flex gap-2">
      <button id="reset" class="px-6 py-2 bg-gradient-to-r from-blue-500 to-green-400 text-white rounded-lg shadow hover:from-blue-600 hover:to-green-500 focus:outline-none focus:ring-2 focus:ring-blue-400 transition hidden">Reset Game</button>
      <button id="playAgain" class="px-6 py-2 bg-gradient-to-r from-yellow-400 to-pink-400 text-white rounded-lg shadow hover:from-yellow-500 hover:to-pink-500 focus:outline-none focus:ring-2 focus:ring-pink-400 transition hidden">Play Again</button>
      <button id="changeNames" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition hidden">Change Names</button>
    </div>
  </div>
  <footer class="mt-8 text-gray-400 text-sm">&copy; 2025 Modern Tic Tac Toe</footer>
  <script>
  // Elements
  const gameContainer = document.getElementById('game');
  const statusDiv = document.getElementById('status');
  const resetBtn = document.getElementById('reset');
  const playAgainBtn = document.getElementById('playAgain');
  const changeNamesBtn = document.getElementById('changeNames');
  const nameForm = document.getElementById('nameForm');
  const playerXInput = document.getElementById('playerX');
  const playerOInput = document.getElementById('playerO');
  const scoreboard = document.getElementById('scoreboard');
  const scoreX = document.getElementById('scoreX');
  const scoreO = document.getElementById('scoreO');
  const nameX = document.getElementById('nameX');
  const nameO = document.getElementById('nameO');
  const darkToggle = document.getElementById('darkToggle');

  // State
  let board = Array(9).fill('');
  let currentPlayer = 'X';
  let gameActive = true;
  let winCells = [];
  let draw = false;
  let playerNames = { X: 'Player X', O: 'Player O' };
  let scores = { X: 0, O: 0 };
  let darkMode = false;
  let moveHistory = [];
  let redoStack = [];
  let lastMoveIdx = null;
  let timers = { X: 0, O: 0 };
  let timerInterval = null;
  let timerStart = null;
  let replayMode = false;
  let replayIndex = 0;
  let replayInterval = null;

  // Sound effects
  const moveSound = new Audio('https://cdn.pixabay.com/audio/2022/07/26/audio_124bfa4c7b.mp3');
  const winSound = new Audio('https://cdn.pixabay.com/audio/2022/07/26/audio_124bfa4c7b.mp3');
  const drawSound = new Audio('https://cdn.pixabay.com/audio/2022/10/16/audio_12b6b1b7b7.mp3');

    function renderBoard() {
      gameContainer.innerHTML = '';
      board.forEach((cell, idx) => {
        const cellDiv = document.createElement('button');
        cellDiv.setAttribute('type', 'button');
        cellDiv.setAttribute('aria-label', `Cell ${idx + 1}`);
        cellDiv.className =
          'w-20 h-20 flex flex-col items-center justify-center text-4xl font-extrabold rounded-lg shadow-md border-2 border-gray-200 bg-gradient-to-br from-gray-50 to-gray-200 transition-all duration-200 outline-none focus:ring-2 focus:ring-blue-400 hover:scale-105 hover:border-blue-400';
        if (winCells.includes(idx)) {
          cellDiv.classList.add('cell-win');
        } else if (draw) {
          cellDiv.classList.add('cell-draw');
        } else if (!cell && gameActive && !replayMode) {
          cellDiv.classList.add('hover:bg-blue-100');
        }
        if (idx === lastMoveIdx && cell) {
          cellDiv.classList.add('ring-4', 'ring-yellow-400');
        }
        cellDiv.innerHTML = cell ? `<span>${cell}</span><span class=\"text-xs text-gray-400 mt-1\">${getMoveNumber(idx)}</span>` : '';
        cellDiv.disabled = !!cell || !gameActive || replayMode;
        if (!replayMode) cellDiv.addEventListener('click', () => handleCellClick(idx, cellDiv));
        gameContainer.appendChild(cellDiv);
      });
    }

    function getMoveNumber(idx) {
      // Find the move number for this cell
      for (let i = 0; i < moveHistory.length; i++) {
        if (moveHistory[i].idx === idx) return i + 1;
      }
      return '';
    }

    function handleCellClick(idx, cellDiv) {
      if (!gameActive || board[idx]) return;
      board[idx] = currentPlayer;
      cellDiv.classList.add('cell-animate');
      moveSound.currentTime = 0; moveSound.play();
      lastMoveIdx = idx;
      // Timer
      if (timerStart) {
        timers[currentPlayer] += (Date.now() - timerStart) / 1000;
        updateTimers();
      }
      moveHistory.push({
        idx,
        player: currentPlayer,
        board: [...board],
        currentPlayer,
      });
      redoStack = [];
      updateMoveHistory();
      updateMoveControls();
      const winner = checkWinner();
      if (winner) {
        gameActive = false;
        draw = false;
        scores[currentPlayer]++;
        updateScoreboard();
        renderBoard();
        statusDiv.innerHTML = `<span class='text-green-600'>${playerNames[currentPlayer]} (<b>${currentPlayer}</b>) wins!</span>`;
        playAgainBtn.classList.remove('hidden');
        winSound.currentTime = 0; winSound.play();
        stopTimer();
        showReplayControls();
      } else if (board.every(cell => cell)) {
        gameActive = false;
        draw = true;
        renderBoard();
        statusDiv.innerHTML = `<span class='text-red-600'>It's a draw between <b>${playerNames['X']}</b> and <b>${playerNames['O']}</b>!</span>`;
        playAgainBtn.classList.remove('hidden');
        drawSound.currentTime = 0; drawSound.play();
        stopTimer();
        showReplayControls();
      } else {
        currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
        draw = false;
        renderBoard();
        statusDiv.innerHTML = `${playerNames[currentPlayer] ? playerNames[currentPlayer] : 'Player ' + currentPlayer} <span class='text-blue-600 font-bold'>(${currentPlayer})</span>'s turn`;
        startTimer();
      }
    }

    function updateTimers() {
      document.getElementById('timerX').textContent = timers.X.toFixed(1);
      document.getElementById('timerO').textContent = timers.O.toFixed(1);
    }

    function startTimer() {
      stopTimer();
      timerStart = Date.now();
      timerInterval = setInterval(() => {
        if (timerStart) {
          const elapsed = (Date.now() - timerStart) / 1000;
          document.getElementById('timer' + currentPlayer).textContent = (timers[currentPlayer] + elapsed).toFixed(1);
        }
      }, 100);
    }

    function stopTimer() {
      if (timerInterval) clearInterval(timerInterval);
      timerInterval = null;
      timerStart = null;
    }

    function updateMoveHistory() {
      const moveHistoryDiv = document.getElementById('moveHistory');
      const moveList = document.getElementById('moveList');
      if (moveHistory.length === 0) {
        moveHistoryDiv.classList.add('hidden');
        moveList.innerHTML = '';
        return;
      }
      moveHistoryDiv.classList.remove('hidden');
      moveList.innerHTML = moveHistory.map((move, i) => {
        const cell = move.idx;
        const row = Math.floor(cell / 3) + 1;
        const col = (cell % 3) + 1;
        return `<li class="mb-1">#${i + 1}: <b>${playerNames[move.player]}</b> (${move.player}) ‚Üí Row ${row}, Col ${col}</li>`;
      }).join('');
    }

    function updateMoveControls() {
      const moveControls = document.getElementById('moveControls');
      if (moveHistory.length > 0 || redoStack.length > 0) {
        moveControls.classList.remove('hidden');
      } else {
        moveControls.classList.add('hidden');
      }
    }

    function checkWinner() {
      const winPatterns = [
        [0,1,2],[3,4,5],[6,7,8], // rows
        [0,3,6],[1,4,7],[2,5,8], // cols
        [0,4,8],[2,4,6]          // diags
      ];
      for (const pattern of winPatterns) {
        const [a, b, c] = pattern;
        if (board[a] && board[a] === board[b] && board[a] === board[c]) {
          winCells = pattern;
          return board[a];
        }
      }
      winCells = [];
      return null;
    }

    function updateScoreboard() {
      scoreX.textContent = scores.X;
      scoreO.textContent = scores.O;
      nameX.textContent = playerNames.X;
      nameO.textContent = playerNames.O;
    }

    resetBtn.addEventListener('click', () => {
      board = Array(9).fill('');
      currentPlayer = 'X';
      gameActive = true;
      winCells = [];
      draw = false;
      moveHistory = [];
      redoStack = [];
      lastMoveIdx = null;
      timers = { X: 0, O: 0 };
      updateTimers();
      stopTimer();
      statusDiv.innerHTML = `${playerNames[currentPlayer]} <span class='text-blue-600 font-bold'>(${currentPlayer})</span>'s turn`;
      renderBoard();
      playAgainBtn.classList.add('hidden');
      updateMoveHistory();
      updateMoveControls();
      hideReplayControls();
      startTimer();
    });

    playAgainBtn.addEventListener('click', () => {
      board = Array(9).fill('');
      currentPlayer = 'X';
      gameActive = true;
      winCells = [];
      draw = false;
      moveHistory = [];
      redoStack = [];
      lastMoveIdx = null;
      timers = { X: 0, O: 0 };
      updateTimers();
      stopTimer();
      statusDiv.innerHTML = `${playerNames[currentPlayer]} <span class='text-blue-600 font-bold'>(${currentPlayer})</span>'s turn`;
      renderBoard();
      playAgainBtn.classList.add('hidden');
      updateMoveHistory();
      updateMoveControls();
      hideReplayControls();
      startTimer();
    });

    document.getElementById('undoBtn').addEventListener('click', () => {
      if (moveHistory.length === 0) return;
      const last = moveHistory.pop();
      redoStack.push(last);
      board = moveHistory.length > 0 ? [...moveHistory[moveHistory.length - 1].board] : Array(9).fill('');
      currentPlayer = moveHistory.length > 0 ? (moveHistory[moveHistory.length - 1].currentPlayer === 'X' ? 'O' : 'X') : 'X';
      winCells = [];
      draw = false;
      lastMoveIdx = moveHistory.length > 0 ? moveHistory[moveHistory.length - 1].idx : null;
      gameActive = !checkWinner() && board.some(cell => !cell);
      renderBoard();
      updateMoveHistory();
      updateMoveControls();
      playAgainBtn.classList.add('hidden');
      statusDiv.innerHTML = `${playerNames[currentPlayer]} <span class='text-blue-600 font-bold'>(${currentPlayer})</span>'s turn`;
    });

    document.getElementById('redoBtn').addEventListener('click', () => {
      if (redoStack.length === 0) return;
      const next = redoStack.pop();
      moveHistory.push(next);
      board = [...next.board];
      currentPlayer = next.currentPlayer === 'X' ? 'O' : 'X';
      lastMoveIdx = next.idx;
      winCells = [];
      draw = false;
      gameActive = !checkWinner() && board.some(cell => !cell);
      renderBoard();
      updateMoveHistory();
      updateMoveControls();
      playAgainBtn.classList.add('hidden');
      statusDiv.innerHTML = `${playerNames[currentPlayer]} <span class='text-blue-600 font-bold'>(${currentPlayer})</span>'s turn`;
    });

    playAgainBtn.addEventListener('click', () => {
      board = Array(9).fill('');
      currentPlayer = 'X';
      gameActive = true;
      winCells = [];
      draw = false;
      statusDiv.innerHTML = `${playerNames[currentPlayer]} <span class='text-blue-600 font-bold'>(${currentPlayer})</span>'s turn`;
      renderBoard();
      playAgainBtn.classList.add('hidden');
    });

    changeNamesBtn.addEventListener('click', () => {
      nameForm.classList.remove('hidden');
      gameContainer.classList.add('hidden');
      resetBtn.classList.add('hidden');
      playAgainBtn.classList.add('hidden');
      changeNamesBtn.classList.add('hidden');
      scoreboard.classList.add('hidden');
      statusDiv.innerHTML = '';
    });

    nameForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const xName = playerXInput.value.trim() || 'X';
      const oName = playerOInput.value.trim() || 'O';
      playerNames = { X: xName, O: oName };
      board = Array(9).fill('');
      currentPlayer = 'X';
      gameActive = true;
      winCells = [];
      draw = false;
      moveHistory = [];
      redoStack = [];
      lastMoveIdx = null;
      timers = { X: 0, O: 0 };
      updateTimers();
      stopTimer();
      nameForm.classList.add('hidden');
      gameContainer.classList.remove('hidden');
      resetBtn.classList.remove('hidden');
      playAgainBtn.classList.add('hidden');
      changeNamesBtn.classList.remove('hidden');
      scoreboard.classList.remove('hidden');
      updateScoreboard();
      updateMoveHistory();
      updateMoveControls();
      hideReplayControls();
      statusDiv.innerHTML = `${playerNames[currentPlayer]} <span class='text-blue-600 font-bold'>(${currentPlayer})</span>'s turn`;
      renderBoard();
      startTimer();
    });
    // --- Replay Feature ---
    function showReplayControls() {
      document.getElementById('replayControls').classList.remove('hidden');
      replayMode = true;
      replayIndex = moveHistory.length;
      renderReplayBoard();
    }

    function hideReplayControls() {
      document.getElementById('replayControls').classList.add('hidden');
      replayMode = false;
      replayIndex = 0;
    }

    function renderReplayBoard() {
      // Set board to the state at replayIndex
      let state = Array(9).fill('');
      let lastIdx = null;
      if (replayIndex > 0) {
        state = [...moveHistory[replayIndex - 1].board];
        lastIdx = moveHistory[replayIndex - 1].idx;
      }
      board = state;
      lastMoveIdx = lastIdx;
      renderBoard();
    }

    document.getElementById('replayStart').addEventListener('click', () => {
      replayIndex = 0;
      renderReplayBoard();
    });
    document.getElementById('replayPrev').addEventListener('click', () => {
      if (replayIndex > 0) replayIndex--;
      renderReplayBoard();
    });
    document.getElementById('replayPlay').addEventListener('click', () => {
      if (replayInterval) return;
      replayInterval = setInterval(() => {
        if (replayIndex < moveHistory.length) {
          replayIndex++;
          renderReplayBoard();
        } else {
          clearInterval(replayInterval);
          replayInterval = null;
        }
      }, 600);
    });
    document.getElementById('replayNext').addEventListener('click', () => {
      if (replayIndex < moveHistory.length) replayIndex++;
      renderReplayBoard();
    });
    document.getElementById('replayEnd').addEventListener('click', () => {
      replayIndex = moveHistory.length;
      renderReplayBoard();
    });
    // Stop replay interval if user clicks any replay button
    ['replayStart','replayPrev','replayNext','replayEnd'].forEach(id => {
      document.getElementById(id).addEventListener('click', () => {
        if (replayInterval) { clearInterval(replayInterval); replayInterval = null; }
      });
    });

    // Keyboard accessibility: allow arrow keys to move focus
    gameContainer.addEventListener('keydown', (e) => {
      const focusable = Array.from(gameContainer.querySelectorAll('button'));
      const idx = focusable.indexOf(document.activeElement);
      if (idx === -1) return;
      let nextIdx = idx;
      if (e.key === 'ArrowRight') nextIdx = (idx + 1) % 9;
      else if (e.key === 'ArrowLeft') nextIdx = (idx + 8) % 9;
      else if (e.key === 'ArrowDown') nextIdx = (idx + 3) % 9;
      else if (e.key === 'ArrowUp') nextIdx = (idx + 6) % 9;
      if (nextIdx !== idx) {
        e.preventDefault();
        focusable[nextIdx].focus();
      }
    });

    // Dark mode toggle
    darkToggle.addEventListener('click', () => {
      darkMode = !darkMode;
      document.body.classList.toggle('dark-mode', darkMode);
      darkToggle.textContent = darkMode ? '‚òÄÔ∏è Light' : 'üåô Dark';
    });

  // Initial render: show name form, hide game and reset
  nameForm.classList.remove('hidden');
  gameContainer.classList.add('hidden');
  resetBtn.classList.add('hidden');
  playAgainBtn.classList.add('hidden');
  changeNamesBtn.classList.add('hidden');
  scoreboard.classList.add('hidden');
  document.getElementById('moveControls').classList.add('hidden');
  document.getElementById('moveHistory').classList.add('hidden');
  document.getElementById('replayControls').classList.add('hidden');
  statusDiv.innerHTML = '';
  </script>
</body>
</html>
